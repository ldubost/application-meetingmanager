<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>MMCode</web>
<name>MeetingMinutes</name>
<language></language>
<defaultLanguage>fr</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1267419600000</creationDate>
<date>1267419600000</date>
<contentUpdateDate>1267419600000</contentUpdateDate>
<version>1.1</version>
<title>MeetingMinutes</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>onDemand=On demand|always=Always</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>MMCode.MeetingMinutes</name>
<number>0</number>
<className>XWiki.JavaScriptExtension</className>
<guid>203bfe23-6106-43e4-ad6e-de7a5dd210ef</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>(function(){

var editorMinutes;
var editorTasks;

document.observe("dom:loaded", function(){
   if ($('editmeetingminutes')) {
     $('editmeetingminutes').observe("click", function(){
        $('minutesedit').toggleClassName('hidden');
        if (!$('minutesedit').hasClassName('hidden') &amp;&amp; typeof editorMinutes == "undefined") {
          editorMinutes = new WysiwygEditor(meetingMinutesEditorConfig);
        }
     });
     $('saveminutes').observe("click", saveMinutes);
     $('saveminutesandclose').observe("click", function(){
        saveMinutes();
        $('minutesedit').addClassName('hidden');
     });
   }
});
function saveMinutes(){
    var url = XWiki.getActionURL(XWiki.currentSpace, XWiki.currentDocument, "save", 0);
    var args = {"ajax":"1"};
    editorMinutes.getSourceText(function(text){
      args["MMCode.MeetingClass_0_minutes"] = text;
      $('minutesview').innerHTML = "&lt;br /&gt;";
      $('minutesview').addClassName("loading");
      var ajx = new Ajax.Request(url, {
        method:"post",
        parameters: args,
        onComplete:function(transport) {
          var savedMsg = new Element("div",{'class':'infomessage'}).update("$msg.get('meetings.meeting.minutes.saved')");
          $('minutesview').insert({before: savedMsg});
          setTimeout(function() { savedMsg.remove();}, 3000);
          var viewURL = "$xwiki.getURL('MMCode.MeetingMinutes','view','xpage=plain&amp;type=minutes')&amp;meeting=" + XWiki.currentSpace + "." + XWiki.currentDocument;
          var ajx2 = new Ajax.Request(viewURL, {
             onComplete: function(transport) {
                $('minutesview').removeClassName("loading");
                $('minutesview').innerHTML = transport.responseText;
             }
          });
        }
      });
    });
}

document.observe("dom:loaded", function(){
   if ($('editmeetingtasks')) {
     $('editmeetingtasks').observe("click", function(){
        $('tasksedit').toggleClassName('hidden');
        if (!$('tasksedit').hasClassName('hidden') &amp;&amp; typeof editorTasks == "undefined") {
           editorTasks = new WysiwygEditor(meetingTasksEditorConfig);
        }
     });
     $('savetasks').observe("click", saveTasks);
     $('savetasksandclose').observe("click", function(){
        saveTasks();
        $('tasksedit').addClassName('hidden');
     });
   }
});
function saveTasks(){
    var url = XWiki.getActionURL(XWiki.currentSpace, XWiki.currentDocument, "save", 0);
    $('tasksview').innerHTML = "&lt;br /&gt;";
    $('tasksview').addClassName("loading");
    editorTasks.getSourceText(function(text) {
      var args = {"ajax":"1", "MMCode.MeetingClass_0_tasks": text};
      var ajx = new Ajax.Request(url, {
        method:"post",
        parameters: args,
        onComplete:function(transport) {
          var savedMsg = new Element("div",{'class':'infomessage'}).update("$msg.get('meetings.meeting.tasks.saved')");
          $('tasksview').insert({before: savedMsg});
          setTimeout(function() { savedMsg.remove();}, 3000);
          var viewURL = "$xwiki.getURL('MMCode.MeetingMinutes','view','xpage=plain&amp;type=tasks')&amp;meeting=" + XWiki.currentSpace + "." + XWiki.currentDocument;
          var ajx2 = new Ajax.Request(viewURL, {
             onComplete: function(transport) {
                $('tasksview').removeClassName("loading");
                $('tasksview').innerHTML = transport.responseText;
             }
          });
        }
      });
   });
}

})();</code>
</property>
<property>
<name>minutes</name>
</property>
<property>
<parse>1</parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<content>{{velocity filter="none"}}
{{html clean="false" wiki="true"}}
#wysiwyg_import(false)
#set($ok = $xwiki.jsx.use('MMCode.MeetingMinutes'))
#if("$!request.type" == "" || "$!request.type" == "minutes")
  #if("$!request.xpage" == "")
&lt;h2 class="meetingh2"&gt;
$msg.get('meetings.meeting.minutes')
&lt;/h2&gt;
&lt;div id="meetingminutes"&gt;
 &lt;div id="editmeetingminutes"&gt;$msg.get('meetings.meeting.minutes.edit')&lt;/div&gt;
  &lt;div id="meetingminutescontent"&gt;
    #if($request.started=="1")
     #info("$msg.get('meetings.meeting.startmeeting.started')")
    #end
    &lt;div id="minutescontent"&gt;
      &lt;div id="minutesedit" class="hidden editableInfos"&gt;
        &lt;div id="minuteseditcontent" class=""&gt;
          $!meeting.display("minutes", "edit")
          ## Set the input value for the editor.
          {{html wiki="false"}}
          #wysiwyg_inputProperty($meetingDoc "MMCode.MeetingClass_0_minutes")
          #wysiwyg_storeConfig("meetingMinutesEditorConfig" $meetingDoc "MMCode.MeetingClass_0_minutes" false)
          {{/html}}
        &lt;/div&gt;
        &lt;span class="buttonwrapper"&gt;
          &lt;button id="saveminutes"&gt;$msg.get('meetings.meeting.saveminutes')&lt;/button&gt;
          &lt;button id="saveminutesandclose"&gt;$msg.get('meetings.meeting.saveminutesandclose')&lt;/button&gt;
        &lt;/span&gt;
      &lt;/div&gt;
      &lt;div id="minutesview"&gt;
  #else
    #set($meetingDoc = $xwiki.getDocument($request.meeting))
    #set($meeting = $meetingDoc.getObject("MMCode.MeetingClass"))
  #end
  #if("$!meeting.getProperty('minutes').value" == "")
    #warning("$msg.get('meetings.meeting.minutes.empty')")
  #else
    $meeting.display('minutes', 'view')
  #end
  #if("$!request.xpage" == "")
    &lt;/div&gt; 
   &lt;/div&gt;
  &lt;/div&gt;
 &lt;/div&gt;
  #end
#end
{{/html}}
{{/velocity}}</content>
</xwikidoc>
