<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>MMCode</web>
<name>MeetingInfos</name>
<language></language>
<defaultLanguage>fr</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1267419600000</creationDate>
<date>1267419600000</date>
<contentUpdateDate>1267419600000</contentUpdateDate>
<version>1.1</version>
<title>MeetingInfos</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>MMCode.MeetingInfos</name>
<number>0</number>
<className>XWiki.JavaScriptExtension</className>
<guid>c3f8ba62-5fcc-430c-97fa-58dbecb8d160</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>(function(){

var serviceURL = "$doc.getURL('view')";

var successMsg = "$msg.get('meetings.meeting.infos.saved')";

var editor;

document.observe("dom:loaded", function() {

  if ($('editmeetinginfos')) {
    Event.observe($('editmeetinginfos'), "click", function() {
      $('meetinginfosedit').toggleClassName("hidden");
      if (!$('meetinginfosedit').hasClassName("hidden") &amp;&amp; typeof editor == "undefined") {
          editor = new WysiwygEditor(meetingDescriptionEditorConfig);
      }
    });
  }

  if ($('meetingInfosSave')) {
    Event.observe($('meetingInfosSave'), "click", saveInfos);
  }

});

function saveInfos() {
  editor.getSourceText(function(text){
    var args = {};
    var fields = $('meetingInfos').select("input", "select");
    
    for (var i=0;i&lt;fields.length;i++) {
      args[fields[i].id] = fields[i].value;
    }
    args.ajax = "1";
    args["MMCode.MeetingClass_0_description"] = text;
    var url = XWiki.getActionURL(XWiki.currentSpace, XWiki.currentDocument, "save", 0);
    $('meetinginfosedit').addClassName("hidden");
    $('meetinginfosview').innerHTML = "";
    $('meetinginfosview').addClassName("loading");

    var ajx = new Ajax.Request(url, {
      method:"post",
      parameters: args,
      onSuccess:function(transport) {
         var url = serviceURL + "?xpage=plain&amp;mode=view&amp;m=" + XWiki.currentSpace + "." + XWiki.currentDocument;
         var ajx2 = new Ajax.Request(url , {
            onSuccess: function(t2) {
               $('meetinginfosview').removeClassName("loading");
               $('meetinginfosview').innerHTML = t2.responseText;
               var successMessage = new Element("div", {'class': 'infomessage'}).update(successMsg);
               Element.insert($('meetingInfos'), {'after': successMessage});
               setTimeout(function() {
                  successMessage.remove();
               }, 3000);
            }
         });
       } 
    });
  });
}


})();</code>
</property>
<property>
<name>meetinginfos</name>
</property>
<property>
<parse>1</parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<object>
<class>
<name>MMCode.MeetingParticipantClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<available>
<name>available</name>
<number>5</number>
<prettyName>available</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</available>
<message>
<contenttype>FullyRenderedText</contenttype>
<customDisplay></customDisplay>
<editor>---</editor>
<name>message</name>
<number>4</number>
<picker>0</picker>
<prettyName>message</prettyName>
<rows>2</rows>
<size>30</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</message>
<participation>
<cache>1</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>participation</name>
<number>2</number>
<picker>0</picker>
<prettyName>participation</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>undecided|confirmed|declined</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</participation>
<presence>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>presence</name>
<number>3</number>
<picker>0</picker>
<prettyName>presence</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>present|absent|late</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</presence>
<unavailable>
<name>unavailable</name>
<number>6</number>
<prettyName>unavailable</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</unavailable>
<username>
<customDisplay></customDisplay>
<name>username</name>
<number>1</number>
<picker>0</picker>
<prettyName>username</prettyName>
<size>30</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</username>
</class>
<name>MMCode.MeetingInfos</name>
<number>0</number>
<className>MMCode.MeetingParticipantClass</className>
<guid>1629cd33-fea1-4fb1-b80d-6984d822b0ae</guid>
<property>
<username>XWiki.JeromeVelociter</username>
</property>
</object>
<content>{{velocity filter="none"}}
{{html clean="false" wiki="false"}} ## We need wiki=false other wise the wysiwyg imports will be transformed (CDATA, etc.)
## ---------------------------------------------------------------------------------
## SX.
## ---------------------------------------------------------------------------------
#set($ok = $xwiki.jsx.use("MMCode.MeetingInfos"))
## ---------------------------------------------------------------------------------
## This page can be either included from a meeting sheet, or hit via AJAX with a target meeting name passed
## as a request parameter. In the first case, the $meetingDoc var will be already set by the including doc, 
## in the second case we retrieve it:
## ---------------------------------------------------------------------------------
#if(!$meetingDoc)
  #set($requested = "$!request.m")
  #if($requested != "")
    #set($meetingDoc = $xwiki.getDocument($requested))
    #set($isManager = false)
    #set($isCyclic = false)
    #isManager($meetingDoc, $isManager)
    #set($isManager = false)
  #end
#else
 ## 
 ## If we are not hit by AJAX, we setup needs for displaying a GWT-WYSYWIG editor for the meeting description.
 ## The actual editor will be fired from javascript when the user clicks "edit meeting infos". See SX attached.
 #wysiwyg_import(false)
 #wysiwyg_inputProperty($meetingDoc "MMCode.MeetingClass_0_description")
 #wysiwyg_storeConfig("meetingDescriptionEditorConfig" $meetingDoc "MMCode.MeetingClass_0_description" false)
#end
{{/html}}
{{html clean="false" wiki="true"}}
#set($meeting = $meetingDoc.getObject("MMCode.MeetingClass"))
#if(!$meeting) #warning("$msg.get('meetings.no_meeting')")
#else
  #set($meetingTitle = $meetingDoc.title)
  #if("$!meetingTitle" == "") #set($meetingTitle = "$doc.name") #end
  #if("$!request.xpage" == "")
    ##
    ## We output container divs and toggle button to edit only if we got included, not called from AJAX.
    ##
    #if($isManager)
    &lt;div id="meetinginfosedit" class="editableInfos hidden"&gt;
    &lt;div&gt;
      &lt;strong&gt;$msg.get('meetings.meeting.title'):&lt;/strong&gt;
      &lt;input type="text" name="title" id="title" value="$!meetingTitle" /&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;span style="vertical-align:top"&gt;
      &lt;strong&gt;$msg.get('meetings.meeting.description'):&lt;/strong&gt;
      &lt;/span&gt; 
      $meeting.display("description", "edit")
    &lt;/div&gt;
    &lt;div class="privacy"&gt;
      &lt;strong style="display:inline;"&gt;$msg.get('meetings.meeting.privacy')&lt;/strong&gt;
      $meeting.display("privacy", "edit")
      &lt;span class="helptip"&gt;&amp;nbsp;Une fiche privée n'est visible que de ses participants.&lt;/span&gt;
    &lt;/div&gt;
    &lt;span class="buttonwrapper"&gt;
      &lt;button id="meetingInfosSave"&gt;$msg.get('meetings.meeting.infos.save')&lt;/button&gt;
    &lt;/span&gt;
  &lt;/div&gt;
    #end
  &lt;div id="meetinginfosview"&gt;
  #end&lt;p class="meetingtitle"&gt;&lt;strong&gt;$msg.get('meetings.meeting.title'): &lt;/strong&gt;
 $meetingTitle&lt;/p&gt;
#if($isCyclic)
  #set($cycleDoc = $xwiki.getDocument($meetingDoc.getObject("MMCode.MeetingCycleItemClass").getProperty('cycle').value))
  #if($cycleDoc.getObject("MMCode.MeetingCycleClass"))
    #set($cycleURL = $cycleDoc.getURL('view'))
    #set($cycleName = $cycleDoc.getObject("MMCode.MeetingCycleClass").getProperty('name').value)
    #set($link = "&lt;a href='$cycleURL'&gt;$cycleName&lt;/a&gt;")
    $msg.get('meetings.meeting.cyclicmeeting', [$link]) &lt;br /&gt;&lt;br /&gt;
  #end
#end
&lt;p class="meetingdesclabel"&gt;&lt;strong&gt;$msg.get('meetings.meeting.description') : &lt;/strong&gt;&lt;/p&gt;&lt;div class="meetingdesccontent"&gt;
$!meeting.display("description", "view")&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;$msg.get('meetings.meeting.privacy')&lt;/strong&gt; 
$meeting.display("privacy", "view")&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;$msg.get('meetings.meeting.date.date')&lt;/strong&gt;
$!meeting.display("date", "view")
#if("$meeting.display('starttime', 'view')" != "" &amp;&amp; "$meeting.display('endtime', 'view')" != "")
$msg.get('meetings.meeting.date.from')  $meeting.display('starttime', 'view') $msg.get('meetings.meeting.date.to') $meeting.display('endtime', 'view')&lt;/p&gt;
#if("$meeting.display('location', 'view')" != "")
&lt;p&gt;&lt;strong&gt;$msg.get('meetings.meeting.vote.location') : &lt;/strong&gt;
$meeting.display('location', 'view') &lt;/p&gt;
#end
#end
&lt;p&gt;&lt;strong&gt;$msg.get('meetings.meeting.manager') : &lt;/strong&gt; 
{{html clean="false"}}$xwiki.getUserName("$meetingDoc.creator"){{/html}}&lt;/p&gt;
#if("$!request.xpage" == "") &lt;/div&gt; #end
#end
{{/html}}
{{/velocity}}</content>
</xwikidoc>